const layers = {
  "filters": [
    {
      "colId": "31d6b783-9115-416c-a13b-af3cb305fe6c",
      "predicateType": "equals",
      "value": 'needle in haystack'
    }
  ]
}

const boardData = {
  "visibilitySettings": {
    "owner": "5f83b906bb51d45cdfb5430e",
    "editors": [
      "5f83b906bb51d45cdfb5430e"
    ],
    "viewers": []
  },
  "columns": [
    {
      "_id": "f331ceca-99c3-4a6f-b5f9-20bdb3df0d7e",
      "value": "path",
      "dataType": 1,
      "colWidth": 333
    },
    {
      "_id": "31d6b783-9115-416c-a13b-af3cb305fe6c",
      "value": "class_id",
      "dataType": 0,
      "colWidth": 365
    }
  ],
  "rows": [
    {
      "_id": "8e9bd3c1-79be-4ea7-bb6f-cb5d5ae99476",
      "index": 0,
      "cells": [
        {
          "_id": "f0b24b25-d826-4907-9201-e75dcddddf71",
          "value": "marvel/0001/001.jpg"
        },
        {
          "_id": "4df8e1c1-c935-4e19-a6af-a28c9bd9fd8d",
          "value": "needle in haystack"
        }
      ]
    },
    {
      "_id": "f6a92cbc-261d-4fd3-a489-cfd0d718e105",
      "index": 1,
      "cells": [
        {
          "_id": "6d9b1aea-df7a-4cbb-9422-a55544b124aa",
          "value": "marvel/0001/002.jpg"
        },
        {
          "_id": "da0834ae-a8ba-4dbe-9c37-b7cd0dadb1ff",
          "value": "2"
        }
      ]
    },
    {
      "_id": "47a9921c-c271-4fd6-bf0e-f698b26b6567",
      "index": 2,
      "cells": [
        {
          "_id": "d9519e09-7ff7-44fc-9b0c-32bfbf206bc4",
          "value": "marvel/0001/003.jpg"
        },
        {
          "_id": "a7be51cb-1dee-48ea-8611-246fc9328a31",
          "value": "hello world"
        }
      ]
    },
    {
      "_id": "477f850f-eb42-4679-85ac-9008b0dda901",
      "index": 3,
      "cells": [
        {
          "_id": "5b139e69-d8cf-4950-b592-2fbdf2addcc7",
          "value": "marvel/0001/004.jpg"
        },
        {
          "_id": "5de7d887-a811-4a60-a4bd-1d248501a35e",
          "value": "4"
        }
      ]
    },
    {
      "_id": "8969fe20-0338-4f36-895b-187f332ccce9",
      "index": 4,
      "cells": [
        {
          "_id": "43bd0fba-5ee4-4f3a-8b11-649fffcae888",
          "value": "marvel/0001/005.jpg"
        },
        {
          "_id": "1b7d8955-691d-4830-a86a-be6ed58e3ebe",
          "value": "1"
        }
      ]
    },
    {
      "_id": "a0cb2943-cff1-472c-99b2-5885d568c26e",
      "index": 5,
      "cells": [
        {
          "_id": "3dd0d8ff-aa14-4795-baad-9643304d806a",
          "value": "marvel/0001/006.jpg"
        },
        {
          "_id": "664f8e6b-9a8c-4cc1-bd01-feff5c167faf",
          "value": "4"
        }
      ]
    },
    {
      "_id": "d7b5b273-7f6c-477e-badf-d698d3167999",
      "index": 6,
      "cells": [
        {
          "_id": "a416a099-ba33-4dbf-b928-436f0b3def86",
          "value": "marvel/0001/007.jpg"
        },
        {
          "_id": "3f25a1b1-f1f3-4470-8362-39d445f5312b",
          "value": "1"
        }
      ]
    },
    {
      "_id": "28cba649-3748-4615-b423-183b0291330a",
      "index": 7,
      "cells": [
        {
          "_id": "aaeb9e02-867f-45e9-9471-1faa73039ffd",
          "value": "marvel/0001/008.jpg"
        },
        {
          "_id": "d2d724ec-d7f6-47a9-82a5-2e6e70c68361",
          "value": "1"
        }
      ]
    },
    {
      "_id": "f56b5c3a-e5a0-4eaa-9be2-9d3d5e9ca206",
      "index": 8,
      "cells": [
        {
          "_id": "8b94e4c8-3b23-4f1e-81a1-0aee9a737007",
          "value": "marvel/0001/009.jpg"
        },
        {
          "_id": "04f2261b-af51-46dd-b5f7-87c19374b96f",
          "value": "1"
        }
      ]
    },
    {
      "_id": "360259ce-fc7e-436b-95dd-b4147eb8406e",
      "index": 9,
      "cells": [
        {
          "_id": "d191363b-dcbb-4b22-bdcc-3ac1016c2a1d",
          "value": "marvel/0001/010.jpg"
        },
        {
          "_id": "82ea369e-d8c6-4c17-9656-0f66d67efbab",
          "value": "1"
        }
      ]
    },
    {
      "_id": "ac5b3e66-7329-4709-9439-49139afae291",
      "index": 10,
      "cells": [
        {
          "_id": "4749fb4c-d93a-43c4-8879-af2cb0948be0",
          "value": "marvel/0002/001.jpg"
        },
        {
          "_id": "c8629f2c-918f-4998-8a08-0cd8c04c93b7",
          "value": "2"
        }
      ]
    },
    {
      "_id": "8a1824ba-2641-4183-a84a-06faca5d62b8",
      "index": 11,
      "cells": [
        {
          "_id": "d4870d7b-b160-4775-ae37-430e366f6c8c",
          "value": "marvel/0002/002.jpg"
        },
        {
          "_id": "4d98bc19-2952-47bd-8ee2-03e387b7b3f8",
          "value": "2"
        }
      ]
    },
    {
      "_id": "a87a17ee-1fff-4e4a-9637-f2505ce77599",
      "index": 12,
      "cells": [
        {
          "_id": "669cb4f1-2391-4b91-a3f1-c56f61cf2b97",
          "value": "marvel/0002/003.jpg"
        },
        {
          "_id": "92383cac-d208-476d-bfd9-987f9f711ebc",
          "value": "2"
        }
      ]
    }
  ]
}

const R = require('ramda');

const predicateMap = {
  equals: (a, b) => a === b,
  notEquals: (a, b) => a !== b,
  contains: (a, b) => b.includes(a),
  lessThan: (a, b) => a < b,
  lessThanEqualTo: (a, b) => a <= b,
  greaterThan: (a, b) => a > b,
  greaterThanEqualTo: (a, b) => a <= b,
  dateBetween: R.__,
}

const layerFunctions = {
  joins: R.identity,
  filters: (layer) => {
    const colAppliedTo = boardData.columns.findIndex(col => col._id === layer.colId);
    return R.filter(
      row => predicateMap[layer.predicateType]?.(layer.value, row.cells[colAppliedTo]?.value)
    )(boardData.rows)
  },
  groupings: R.identity,
  sortings: R.identity,
  formatting: R.identity,
}

const debug = input => {
  console.log(input)
  return input;
}

const applyDatasetLayers = (layers, boardData) => {
  const applyLayers = R.pipe(
    layerFunctions.joins,
    layerFunctions.filters,
    layerFunctions.groupings,
    layerFunctions.sortings,
    layerFunctions.formatting,
  )

  const mapLayer = R.map(layer => {
    console.log(layer)
    console.log(R.juxt(layer)(boardData.rows))
    return layerFunctions['filters'](layer)
  });

  console.log(R.juxt(layers.filters, layerFunctions['filters']))

  console.log(mapLayer(layers))

  // const test = R.map(x => {
  //   console.log(x)
  //   return R.map(mapLayer('filters'))(x);
  // });

  // console.log(test(layers));
  

  return applyLayers({
    "colId": "31d6b783-9115-416c-a13b-af3cb305fe6c",
    "predicateType": "equals",
    "value": 'needle in haystack'
  });
}

const layered = applyDatasetLayers(layers, boardData); 